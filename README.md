# doc-qa
üá¨üáß [English](README-en.md)

–¢–µ–ª–µ–≥—Ä–∞–º –±–æ—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º —Å –ø–æ–º–æ—â—å—é `LangChain`. –°–¥–µ–ª–∞–Ω –≤ —Ä–∞–º–∫–∞—Ö —Ö–∞–∫–∞—Ç–æ–Ω–∞ –¥–ª—è –¥–∞–Ω–Ω—ã—Ö, –Ω–∞—Ö–æ–¥—è—â–∏—Ö—Å—è –ø–æ–¥ NDA.

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç
### –ü–∞—Ä—Å–∏–Ω–≥ `html`
–í–µ—Å—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–π –Ω–∞–º –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —ç–ª–µ–º–µ–Ω—Ç–µ `div` —Å –∫–ª–∞—Å—Å–æ–º `wiki-content` (–æ–¥–Ω–æ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –∏–∑ 840 —Å—Ç—Ä–∞–Ω–∏—Ü). –¢–∞–∫–∂–µ –∏–∑ `html` —Ñ–∞–π–ª–∞ –º–æ–∂–Ω–æ –∏–∑–≤–ª–µ—á—å —Å—Å—ã–ª–∫—É –¥–ª—è `Confluence`, –∏–∑-–∑–∞ —á–µ–≥–æ –º—ã –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ `txt` —Ñ–∞–π–ª—ã. –î–∞–Ω–Ω—ã–µ –∏–∑–≤–ª–µ–∫–∞–µ–º —Å –ø–æ–º–æ—â—å—é `BeautifulSoup`.

### `LangChain`
1. –†–∞–∑—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π –∫–ª–∞—Å—Å `Retriever` –ø–æ–ª—É—á–∞–µ—Ç –Ω–∞ –≤—Ö–æ–¥ –ø—É—Ç—å –∫ `zip` –∞—Ä—Ö–∏–≤—É, –∏–∑ –∫–æ—Ç–æ—Ä–æ–≥–æ —Å—á–∏—Ç—ã–≤–∞–µ—Ç `html` —Ñ–∞–π–ª—ã –∏ —Å–æ–∑–¥–∞—ë—Ç —Å–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∫–ª–∞—Å—Å–∞ [`langchain_core.documents.base.Document`](https://api.python.langchain.com/en/latest/documents/langchain_core.documents.base.Document.html). –£ –∫–∞–∂–¥–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –µ—Å—Ç—å `page_content` –∏ `metadata`. –í `page_content` –º—ã –∑–∞–≥—Ä—É–∂–∞–µ–º `wiki-content` —Å—Ç—Ä–∞–Ω–∏—Ü—ã, –≤ `metadata` –∑–∞–≥—Ä—É–∂–∞–µ–º –∏–∑–≤–ª–µ—á–µ–Ω–Ω—É—é —Å—Å—ã–ª–∫—É, –Ω–∞–∑–≤–∞–Ω–∏–µ `html` —Ñ–∞–π–ª–∞ –∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –æ—Ç–¥–µ–ª–∞.
2. –ò–∑ –ø–æ–ª—É—á–µ–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Å–æ–∑–¥–∞—é—Ç—Å—è —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ —Å –ø–æ–º–æ—â—å—é –æ–¥–Ω–æ–≥–æ –∏–∑ 
[Text Splitters](https://python.langchain.com/v0.1/docs/modules/data_connection/document_transformers), –≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ [`RecursiveCharacterTextSplitter`](https://api.python.langchain.com/en/latest/character/langchain_text_splitters.character.RecursiveCharacterTextSplitter.html).
3. –ò–∑ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤ —Ç–µ–∫—Å—Ç–æ–≤ —Å –ø–æ–º–æ—â—å—é –º–æ–¥–µ–ª–∏ –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è [`cointegrated/LaBSE-en-ru`](https://huggingface.co/cointegrated/LaBSE-en-ru) —Å–æ–∑–¥–∞—ë—Ç—Å—è [–≤–µ–∫—Ç–æ—Ä–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ](https://python.langchain.com/v0.1/docs/modules/data_connection/vectorstores) `Chroma`.
4. –ü–æ –º–µ—Ç–æ–¥—É `Maximal Marginal Relevance` –Ω–∞—Ö–æ–¥—è—Ç—Å—è —Ç–æ–ø `k` –ø–æ—Ö–æ–∂–∏—Ö –Ω–∞ –∑–∞–¥–∞–Ω–Ω—ã–π –≤–æ–ø—Ä–æ—Å —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤, –ø–æ—Å–ª–µ —á–µ–≥–æ —ç—Ç–∏ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è [`DocumentCompressorPipeline`](https://api.python.langchain.com/en/latest/retrievers/langchain.retrievers.document_compressors.base.DocumentCompressorPipeline.html), —Å–æ—Å—Ç–æ—è—â–∏–º –∏–∑ –µ—â–µ –æ–¥–Ω–æ–≥–æ [`RecursiveCharacterTextSplitter`](https://api.python.langchain.com/en/latest/character/langchain_text_splitters.character.RecursiveCharacterTextSplitter.html) –∏ –∏–∑ [`EmbeddingsFilter`](https://api.python.langchain.com/en/latest/retrievers/langchain.retrievers.document_compressors.embeddings_filter.EmbeddingsFilter.html) –∫–æ—Ç–æ—Ä—ã–π –≤—ã–±–∏—Ä–∞–µ—Ç –∏–∑ –µ—â–µ –±–æ–ª–µ–µ –º–µ–ª–∫–∏—Ö —Ñ—Ä–∞–≥–º–µ–Ω—Ç–æ–≤ –Ω–∞–∏–±–æ–ª–µ–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ.

### –ë–æ—Ç
–í –±–æ—Ç–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø—Ä–æ—Å—Ç–µ–π—à–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∏ –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ –≤–µ–∫—Ç–æ—Ä–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ. –î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–∞ —Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –ª–∏–±–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –≤—Ä—É—á–Ω—É—é –≤ `data/admins.csv`, —Å–æ–∑–¥–∞–Ω–Ω—ã–π –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥–æ–π `/add_user <telegram_id> <username>`.

#### –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞
```
# –í—ã–≤–µ—Å—Ç–∏ –ø–æ–º–æ—â—å.
/help

# –î–æ–±–∞–≤–∏—Ç—å –∫ –≤–µ–∫—Ç–æ—Ä–Ω–æ–º—É —Ö—Ä–∞–Ω–∏–ª–∏—â—É –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏–∑ zip –∞—Ä—Ö–∏–≤–∞.
# –¢—Ä–µ–±—É—é—Ç—Å—è –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.
/add_docs <path/to/file.zip>
/add_docs data/data.zip

# –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
# –¢—Ä–µ–±—É—é—Ç—Å—è –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.
/add_user <telegram_id> <username>
/add_user 6385486588 molokhovdmitry
```

### –ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ —É–ª—É—á—à–µ–Ω–∏—é –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ
- –û—Å–Ω–æ–≤–Ω—ã–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–¥–Ω–æ–π –∏–∑ LLM, [—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –≤ `LangChain`](https://python.langchain.com/v0.1/docs/integrations/chat/). –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å LLM –Ω–∞ —ç—Ç–∞–ø–µ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –≤–æ–ø—Ä–æ—Å, –≥–¥–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ —Å –ø–æ–º–æ—â—å—é [`DocumentCompressorPipeline`](https://api.python.langchain.com/en/latest/retrievers/langchain.retrievers.document_compressors.base.DocumentCompressorPipeline.html) —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –º–æ–¥–µ–ª—å—é –∫–∞–∫ –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –≤–æ–ø—Ä–æ—Å. –¢–∞–∫–∂–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å [—Ñ—É–Ω–∫—Ü–∏–∏ –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è](https://python.langchain.com/v0.1/docs/integrations/text_embedding/) —ç—Ç–∏—Ö –º–æ–¥–µ–ª–µ–π –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞.
- –í—ã–±–æ—Ä –¥—Ä—É–≥–∏—Ö —Ç–∏–ø–æ–≤ —Å–ø–ª–∏—Ç—Ç–µ—Ä–æ–≤ –∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ `chunk_size`, `chunk_overlap` –∏ `separators` —Å–ø–ª–∏—Ç—Ç–µ—Ä–æ–≤.
- –í—ã–±–æ—Ä –¥—Ä—É–≥–æ–≥–æ [`Retriever`](https://python.langchain.com/v0.1/docs/modules/data_connection/retrievers/) –≤–º–µ—Å—Ç–æ `Vectorstore`.
- –í—ã–±–æ—Ä –¥—Ä—É–≥–æ–≥–æ –º–µ—Ç–æ–¥–∞ –ø–æ–∏—Å–∫–∞ –≤–º–µ—Å—Ç–æ `Maximum Marginal Relevance`.
- –ò–∑–º–µ–Ω–µ–Ω–∏–µ [–ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤](https://python.langchain.com/v0.1/docs/modules/data_connection/retrievers/vectorstore/) `fetch_k`, `k` –∏ `lambda_mult` –¥–ª—è –º–µ—Ç–æ–¥–∞ –ø–æ–∏—Å–∫–∞.

## –î–∞–Ω–Ω—ã–µ –ü–≠–ö
–î–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ —Å –¥–∞–Ω–Ω—ã–º–∏ –ü–≠–ö, —Å–∫–∞—á–∞–π—Ç–µ –≤—Å–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã `zip` –∞—Ä—Ö–∏–≤–æ–º, –ø–µ—Ä–µ–∏–º–µ–Ω—É–π—Ç–µ –∞—Ä—Ö–∏–≤ –≤ `data.zip`, –ø–æ–º–µ—Å—Ç–∏—Ç–µ –µ–≥–æ –≤ –ø–∞–ø–∫—É `data` —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è, –¥–∞–ª–µ–µ —Å–ª–µ–¥—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ –∏ –∑–∞–ø—É—Å–∫—É.

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫
```
git clone https://github.com/molokhovdmitry/doc-qa
cd doc-qa
```
–ü–µ—Ä–µ–∏–º–µ–Ω—É–π—Ç–µ —Ñ–∞–π–ª `.env.example` –≤ `.env`, —É–∫–∞–∂–∏—Ç–µ –≤ –Ω–µ–º —Ç–æ–∫–µ–Ω –¥–ª—è —Ç–µ–ª–µ–≥—Ä–∞–º –±–æ—Ç–∞ –∏ –ø—É—Ç—å –∫ –∞—Ä—Ö–∏–≤—É —Å –¥–∞–Ω–Ω—ã–º–∏.

–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```
python -m venv venv
source venv/bin/activate
pip install -r requirements.txt
```

–ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç:
```
python -m src.bot
```
–í–≤–µ–¥–∏—Ç–µ –≤ `admins.csv` –≤–∞—à Telegram ID –∏ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫–æ –≤—Å–µ–º –∫–æ–º–∞–Ω–¥–∞–º –±–æ—Ç–∞.

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –∏ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –±–æ–ª—å—à–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–ø—Ä–æ—Å–æ–≤ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –Ω–∞–ª–∏—á–∏–µ –≤–∏–¥–µ–æ–∫–∞—Ä—Ç—ã.

–î–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è —Å–∫–æ—Ä–æ—Å—Ç–∏ —Å–æ–∑–¥–∞–Ω–∏—è –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ –º–æ–∂–Ω–æ –ø–æ–≤—ã—Å–∏—Ç—å `chunk_size` –∏ –ø–æ–Ω–∏–∑–∏—Ç—å `chunk_overlap` —É `RecursiveCharacterTextSplitter`, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ –¥–µ–ª–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –Ω–∞ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã.

–î–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è —Å–∫–æ—Ä–æ—Å—Ç–∏ –æ—Ç–≤–µ—Ç–∞ –Ω–∞ –≤–æ–ø—Ä–æ—Å –º–æ–∂–Ω–æ –ø–æ–Ω–∏–∑–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã `fetch_k`, –∏ `k` –º–µ—Ç–æ–¥–∞ –ø–æ–∏—Å–∫–∞.
